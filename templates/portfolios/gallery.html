{% extends "portfolio_base.html" %}
{% block stylesheet %}
<link rel="stylesheet" href="{{ STATIC_URL }}js/galleria/themes/classic/galleria.classic.css">
{% endblock %}
{% block head %}
<style>
    #galleria{ width: 100%; height: 550px; background: #000 }
    body .galleria-container{ background:#{{ profile.background_color }}; }
</style>
{% endblock %}

{% block script %}
{% if user.is_authenticated and user.username == username %}
<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/confirm-delete.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/csrf.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/sorting.js"></script>
<script>
$(document).ready(function(){
  $("#toggle-directions").click(function(){
    $("#directions").toggle(200);
  });
});
</script>
{% endif %}
<script type="text/javascript" src="{{ STATIC_URL }}js/galleria/galleria-1.2.9.min.js"></script>
<script src="{{ STATIC_URL }}js/galleria/themes/classic/galleria.classic.min.js"></script>
{% endblock %}

{% block title %}{{ profile.fullname }} | {{ gallery.title }}{% endblock %}

{% block content %}

{% if user.is_authenticated and user.username == username %}
{% if profile.photo_count > customer.account_limit %}
<h1 style="color: red">UPLOAD LIMIT EXCEEDED</h1>
<p style="color: orange"><em>This gallery is currently <b>hidden</b> because you've exceeded your upload limit ({{ customer.account_limit }} uploads). 
    Please either <a href="/settings">upgrade</a> your account or delete the excess 
    photos to re-enable your public portfolio.</em></p>
{% endif %}
<a id="toggle-directions" style="cursor: pointer"><b>Toggle directions</b></a>
<ul class="muted" id="directions">
  <li><em>Rearrange</em> photos by dragging and dropping them</li>
  <li><img src="{{ STATIC_URL }}img/delete.png"> a photo or <img src="{{ STATIC_URL }}img/edit.png"> the photo's caption</li>
  <li><a href="/upload/{{ gallery.pk }}/"><em>Upload</em></a> a photo into this gallery</li>
  <li><em><a href="/edit/">Customize</a></em> the styling</li>
</ul>
<div id="dialog" title="Are you sure?">
  <p>
    <span class="ui-icon ui-icon-alert"></span>
    This photo or video will be permanently deleted.</p>
</div>
{% endif %}

{% if user.is_authenticated and username == user.username %}
<!-- Edit mode -->
<div class="row">
  <div class="span12">
    <ul class="thumbnails sortable-items">
      {% for item in gallery.item_set.all %}
      <li id="items_{{ item.pk }}">
	<div style="position: relative; left: 0; top: 0;">
	  {% if item.is_photo %}
	  <a href="{{ item.photo.image.url }}" target="_blank">
	    <img src="{{ item.photo.thumbnail_3.url }}">
	  </a>
	  {% else %}
	  <a href="{{ item.video.url }}" target="_blank">
	    <img src="{{ STATIC_URL }}img/empty_gallery_square.png">
	  </a>
	  {% endif %}
	  <a href="/item/{{ item.pk }}/delete/" class="confirm">
	    <img src="{{ STATIC_URL }}img/delete.png" style="position: absolute; top: 0; right: 0">
	  </a>
	  <a href="/item/{{ item.pk }}/edit/">
	    <img src="{{ STATIC_URL }}img/edit.png" style="position: absolute; bottom: 0; left: 0;"/>
	  </a>
	</div>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% elif profile.photo_count <= customer.account_limit %}
<!-- Display mode -->
<div id="galleria">
  {% for item in gallery.item_set.all %}
  {% if item.is_photo %}
  <a href="{{ item.photo.image.url }}"><img src="{{ item.photo.thumbnail_3.url }}" data-title="{{ item.caption }}"></a>
  {% else %}
  <a href="{{ item.video.url }}"><span class="video" data-title="{{ item.caption }}"></span></a>
  {% endif %}
  {% endfor %}
</div>
<script>
  Galleria.run('#galleria', {
    debug: false,
    lightbox: true
});
</script>
{% endif %}

{% endblock %}
